---
layout: default
title: "SQLMap"
permalink: /ActiveDiscovery/SQLMap/
nav_order: 10
parent: Active Discovery
---

Power on the attacking host.  Open a command line interface and run the following commands to download sqlmap.

``git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev``

Run the following command to verify that sqlmap is updated.

``sudo apt install --only-upgrade sqlmap``

Visit Portswigger``s website to download and install the latest version of Burp Suite.  Once downloaded, launch sqlmap with the command:

``sudo sqlmap –help``

![sqlmap1](/media/sqlmap_1.png)
![sqlmap2](/media/sqlmap_2.png)
![sqlmap3](/media/sqlmap_3.png)

sqlmap has a host of options that can be modified to help a penetration tester in the efforts.  The ``-g`` option pipes the results of a Google dork search directly into the URL field of an sqlmap command.  The ``—proxy=`` is useful for hiding the originating source of the SQL injection by directing traffic through a proxy.  The ``—random-agent`` will insert a random value selected from the ``user-agents.txt`` file into the HTTP header.  The ``—level=`` and ``—risk=`` commands allow for modifications in the level of tests conducted by the scanner as well as the level of risk for each test conducted.  The ``—wizard`` command walks users through a simple wizard to help determine which switches to add to a given scan.  Note, the scan will be very simple and will only note the basest of vulnerabilities.  Lastly, the ``-a`` command will attempt to enumerate every option that sqlmap provides and can reveal a trove of data.  
After reviewing the sqlmap help page, launch Burp Suite by typing the entering the following command.

## Burp Suite

Navigate to the Proxy tab and then the Intercept tab and verify that ``Intercept is on`` option has been enabled.

![sqlmap4](/media/sqlmap_4.png)

Open a web browser and navigate to the identified database server.

![sqlmap5](/media/sqlmap_5.png)

Activate the proxy software and direct all traffic to Burp Suite; the default location for Burp Suite is 127.0.0.1:8080.  

![sqlmap6](/media/sqlmap_6.png)

Return to the vulnerable web application and enter the value ``1`` into the field.  The traffic to and from the server will be routed through Burp Suite.  Burp Suite will capture the GET response from the page and reveal the session cookie generated by the web application.  This session cookie will be important for the remainder of the demonstration.

![sqlmap7](/media/sqlmap_7.png)

Return to the command line interface and enter the following command:

``Sudo sqlmap –u [URL] –cookie="security=low ; PHPSESSID=rnqtr18q50ted2p8t41b8udv11" --dbs``

![sqlmap8](/media/sqlmap_8.png)

The ``-u`` command is the URL where the vulnerable database resides, the ``—cookie=`` command inserts the captured session cookie into the requests that are sent by sqlmap, and the ``—dbs`` option enumerates the underlying database.  Note that sqlmap found two databases in its scan:  dvwa and information_schema.
Having found these, enter the following command to attempt to enumerate the tables contained within the database ``dvwa:``

``Sudo sqlmap –u [URL] –cookie="security=low ; PHPSESSID=rnqtr18q50ted2p8t41b8udv11" -D dvwa –tables``

![sqlmap9](/media/sqlmap_9.png)

The ``-D`` switch denotes which database the next command should be run against.  The ``—tables`` switch tells the scanner to enumerate the tables held underneath the database.  As noted above, the scanner revealed the tables, ``guestbook`` and ``users,`` in its scans.  To identify the information contained within the ``users`` table run the following command:

``Sudo sqlmap –u [URL] –cookie="security=low ; PHPSESSID=rnqtr18q50ted2p8t41b8udv11" -D dvwa -T users –columns``

![sqlmap10](/media/sqlmap_10.png)

The table output from the scan notes the titles of columns contained within the database as well as the restrictions on input into those fields.  One item of note is that the ``user_id`` fields is limited to an integer input of six ``(int(6))`` meaning that only six users are allowed on the system.  With this information one final scan can be run to gather the usernames, passwords with hashes, and user ids for the database.

``Sudo sqlmap –u [URL] –cookie="security=low ; PHPSESSID=rnqtr18q50ted2p8t41b8udv11" -D dvwa -T users -C user,password,user_id --dump``

![sqlmap11](/media/sqlmap_11.png)

The option ``-T`` tells the scanner to target the specified table while the option ``-C`` tells the scanner to target the following columns.  ``—dump`` dumps the table entities.  During the dump, sqlmap will attempt to crack the identified password hashes through either brute force attacks or by matching the output to a text file of known password hashes.  Attackers are also given the option to export the file to a format to be used with other password cracking tools.  From the results it is made known that there are six users as established by the user id limitations.  Likewise, the passwords for each user are made known to the attacker.  From here an attacker could leverage the admin account to conduct further exploits on the system, without needing to exploit a vulnerability in the application.

Once the attacker is finished, simply closing the web browser for the associated token will eventually terminate the session.  If the attacker has gained root privileges on the compromised host, he or she may attempt to locate the log file and delete its contents to eliminate any traces of activity on the host that would conclusively point to him or her.  To uninstall sqlmap enter the following command into the command line interface:

``Sudo apt-get purge –auto-remove sqlmap``

The ``purge`` option will remove all local configuration data from the attacking host.  Burp suite may also be removed with a similar command:

``Sudo apt-get purge –auto-remove burpsuite``

To reiterate, sqlmap is a powerful tool that an attacker may use to enumerate and exploit vulnerable web application databases.  It features a host of switches that can be tailored to fit almost any means of attacking a database.  It may be combined with other tools such as several included in the Metasploit framework to deliver payloads to exploit vulnerable databases.  sqlmap is useful in exploiting almost any database server, from the simplest, most ill-secured, to the hardened accessible only through zero-day attacks.  Any serious penetration tester would benefit from the inclusion of sqlmap into his or her toolbox.

[sqlmap homepage](http://sqlmap.org/)

[GitHub sqlmap wiki](https://github.com/sqlmapproject/sqlmap/wiki/Usage)

[Expanded command list](https://resources.infosecinstitute.com/important-sqlmap-commands/)

[Burp Suite homepage](https://portswigger.net/)

[sqlmap](https://github.com/sqlmapproject/sqlmap/zipball/master)

[Burp Suite](https://portswigger.net/burp/releases/professional-community-2020-2?requestededition=community)

[FoxyProxy](https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/?src=search)
